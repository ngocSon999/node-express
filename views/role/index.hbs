<div class="d-flex justify-content-between align-items-center mb-4">
  <h3 class="m-0">{{t 'user.management'}}</h3>
  {{#if (hasPermission user 'create role')}}
  <a class="btn btn-primary btn-sm" href="{{ routes 'roleCreate' }}">{{t 'role.createNew'}}</a>
  {{/if}}
</div>
<table class="table table-bordered table-striped">
    <thead>
        <tr>
            <th>ID</th>
            <th>{{t 'role.name'}}</th>
            <th>{{t 'role.slug'}}</th>
            <th>{{t 'role.description'}}</th>
            <th>{{t 'role.permissions'}}</th>
            <th>{{t 'common.actions'}}</th>
        </tr>
    </thead>
    <tbody>
        {{#each roles}}
        <tr>
            <td>{{this.id}}</td>
            <td>{{this.name}}</td>
            <td>{{this.slug}}</td>
            <td>{{this.description}}</td>
            <td>{{formatPermissions this.permissions}}</td>
            <td>
                {{#if (hasPermission ../user 'update role')}}
                <a href="/admin/role/edit/{{this.id}}" class="btn btn-sm btn-info">{{t 'common.edit'}}</a>
                {{/if}}
                {{#if (hasPermission ../user 'delete role')}}
                <button class="btn btn-sm btn-danger" onclick="deleteRole({{this.id}})">{{t 'common.delete'}}</button>
                {{/if}}
            </td>
        </tr>
        {{/each}}
    </tbody>
</table>

<script>


    // Delete role with confirmation modal
    async function deleteRole(id) {
        if (confirm('{{t "role.deleteConfirm"}}')) {
            try {
                const response = await fetch(`/api/v1/role/${id}`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();

                if (data.success) {
                    showAlert('{{t "role.deleteSuccess"}}', 'success');
                    // Reload the page after a short delay to show the alert
                    setTimeout(() => {
                        window.location.reload();
                    }, 1000);
                } else {
                    showAlert(data.message || '{{t "role.deleteError"}}', 'error');
                }
            } catch (error) {
                console.error('Error deleting role:', error);
                showAlert('{{t "error.500"}}', 'error');
            }
        }
    }
</script>