<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{title}}</title>
    <link href="/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/style.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
</head>
<body>
   <div class="d-flex" id="wrapper">
    <!-- Sidebar -->
    <nav id="sidebar" class="bg-light border-end d-none d-md-block">
      <div class="sidebar-heading px-3 pt-4 fw-bold">Admin Panel</div>
      <div class="list-group list-group-flush">
        <a href="{{ routes 'dashboard'}}" class="list-group-item list-group-item-action">Dashboard</a>
        <a href="{{ routes 'userManage'}}" class="list-group-item list-group-item-action">Users</a>
        <a href="{{ routes 'roleManage'}}" class="list-group-item list-group-item-action">Roles</a>
      </div>
    </nav>

    <!-- Page Content -->
    <div id="page-content-wrapper" class="flex-grow-1">
      <!-- Top bar -->
      <nav class="navbar navbar-light bg-white border-bottom px-3">
        <div class="d-flex justify-content-between w-100 align-items-center">
          <button class="btn btn-outline-primary d-md-none" id="menu-toggle">â˜°</button>
          <div class="dropdown">
            <button class="btn btn-light dropdown-toggle" type="button" id="userDropdown" data-bs-toggle="dropdown" aria-expanded="false">
              {{#if user.avatar}}
                <img src="{{user.avatar}}" alt="{{user.name}}" class="rounded-circle" width="30" height="30">
              {{else}}
                <i class="bi bi-person-circle"></i>
              {{/if}}
              {{user.name}}
            </button>
            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
              <li><a class="dropdown-item" onclick="logout()">Logout</a></li>
            </ul>
          </div>
        </div>
      </nav>

      <div class="container-fluid py-4">
        {{{body}}}
      </div>
    </div>
  </div>

  <div id="alertBox"></div>

    <script>
        document.getElementById("menu-toggle").addEventListener("click", function () {
          document.getElementById("sidebar").classList.toggle("d-none");
        });

        function showAlert(message, type = 'success', url = '#') {
        const alert = document.createElement('div');
        alert.className = `alert alert-${type} alert-dismissible fade show mt-3`;
        alert.role = 'alert';
        alert.innerHTML = `
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        `;
        document.querySelector('#alertBox')?.appendChild(alert);

        setTimeout(function() {
            alert.remove();
            window.location.href = url;
        }, 2000)
    }

    async function logout() {
      try {
        const response = await fetch('/api/v1/auth/logout', {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json'
            },
        });

        const data = await response.json();
        if (data.success === true) {
            // save token to cookie
            document.cookie = `token=; path=/; max-age=0`;
            // Redirect after login
            window.location.href = '{{ routes "login"}}';
        } else {
            showAlert(data.message);
        }
      } catch (error) {
          console.error('Error:', error);
      }
    }
    </script>
    <script src="/js/bootstrap.bundle.min.js"></script>
</body>
</html>
